generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
  binaryTargets   = ["native", "linux-musl"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["talent_clouds"]
}

model TalentCloud {
  id          String                  @id @default(uuid())
  name        String
  description String?
  ownerId     String // reference to User (enterprise admin)
  visibility  Visibility              @default(PRIVATE)
  costCenter  String?
  budget      Float?                  @default(0)
  createdAt   DateTime                @default(now())
  updatedAt   DateTime                @updatedAt
  members     TalentCloudMember[]
  invitations TalentCloudInvitation[]
  budgets     CloudBudget[]
  policies    CloudPolicy[]

  @@schema("talent_clouds")
}

model CloudBudget {
  id        String    @id @default(uuid())
  cloudId   String
  amount    Decimal
  currency  String    @default("USD")
  period    String // MONTHLY, QUARTERLY, PROJECT
  startDate DateTime
  endDate   DateTime?
  spent     Decimal   @default(0.0)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  cloud TalentCloud @relation(fields: [cloudId], references: [id])

  @@schema("talent_clouds")
}

model CloudPolicy {
  id        String     @id @default(uuid())
  cloudId   String
  type      PolicyType
  config    Json // Flexible configuration
  isActive  Boolean    @default(true)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  cloud TalentCloud @relation(fields: [cloudId], references: [id])

  @@schema("talent_clouds")
}

model TalentCloudMember {
  id       String           @id @default(uuid())
  cloudId  String
  userId   String // reference to User (freelancer)
  joinedAt DateTime         @default(now())
  role     CloudRole        @default(MEMBER)
  status   MembershipStatus @default(ACTIVE)
  metadata Json?

  cloud TalentCloud @relation(fields: [cloudId], references: [id])

  @@unique([cloudId, userId])
  @@schema("talent_clouds")
}

model TalentCloudInvitation {
  id        String           @id @default(uuid())
  cloudId   String
  inviteeId String // User ID of the freelancer
  inviterId String // User ID of the person who sent the invite
  email     String?
  status    InvitationStatus @default(PENDING)
  expiresAt DateTime?
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt

  cloud TalentCloud @relation(fields: [cloudId], references: [id])

  @@schema("talent_clouds")
}

enum Visibility {
  PRIVATE
  PUBLIC

  @@schema("talent_clouds")
}

enum CloudRole {
  OWNER
  ADMIN
  MEMBER

  @@schema("talent_clouds")
}

enum MembershipStatus {
  INVITED
  ACTIVE
  REMOVED

  @@schema("talent_clouds")
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  REJECTED
  EXPIRED

  @@schema("talent_clouds")
}

enum PolicyType {
  RATE_LIMIT
  REQUIRED_SKILL
  LOCATION_RESTRICTION
  CUSTOM

  @@schema("talent_clouds")
}
