generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl"]
}

datasource db {
  provider = "postgresql"
  schemas  = ["payments"]
}

model Wallet {
  id                      String        @id @default(uuid())
  userId                  String        @unique
  balance                 Decimal       @default(0.00)
  currency                String        @default("USD")
  preferredCurrency       String        @default("USD")
  cryptoAddress           String?
  createdAt               DateTime      @default(now())
  updatedAt               DateTime      @updatedAt
  autoWithdrawalEnabled   Boolean       @default(false)
  autoWithdrawalSchedule  String?
  autoWithdrawalThreshold Decimal?
  pendingBalance          Decimal       @default(0.00)
  autoWithdrawalMethodId  String?
  
  // Auto-deposit (Client)
  autoDepositEnabled      Boolean       @default(false)
  autoDepositThreshold    Decimal?
  autoDepositAmount       Decimal?
  paymentMethodId         String?

  transactions            Transaction[]

  @@schema("payments")
}

model PaymentMethod {
  id        String   @id @default(uuid())
  userId    String
  type      String   // e.g., "CREDIT_CARD"
  last4     String?
  brand     String?
  token     String   // Provider token
  isDefault Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@schema("payments")
}

model Transaction {
  id          String    @id @default(uuid())
  walletId    String
  amount      Decimal
  type        String
  status      String
  referenceId String?
  description String?
  createdAt   DateTime  @default(now())
  clearedAt   DateTime?
  feeAmount   Decimal   @default(0.0)
  invoiceId   String?
  taxAmount   Decimal   @default(0.0)
  invoice     Invoice?  @relation(fields: [invoiceId], references: [id])
  wallet      Wallet    @relation(fields: [walletId], references: [id])

  @@schema("payments")
}

model Invoice {
  id            String        @id @default(uuid())
  invoiceNumber String        @unique
  senderId      String
  receiverId    String
  amount        Decimal
  taxAmount     Decimal       @default(0.0)
  feeAmount     Decimal       @default(0.0)
  currency      String        @default("USD")
  status        String        @default("UNPAID")
  dueDate       DateTime?
  paidAt        DateTime?
  items         Json
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  transactions  Transaction[]

  @@schema("payments")
}

model ConnectsHistory {
  id        String   @id @default(uuid())
  userId    String
  amount    Int
  type      String
  reason    String?
  createdAt DateTime @default(now())

  @@schema("payments")
}

model TaxSetting {
  id          String   @id @default(uuid())
  countryCode String   @unique
  taxRate     Decimal
  name        String
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@schema("payments")
}

model WithdrawalMethod {
  id            String   @id @default(uuid())
  userId        String
  type          String
  provider      String?
  accountNumber String
  accountName   String
  isDefault     Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@schema("payments")
}
