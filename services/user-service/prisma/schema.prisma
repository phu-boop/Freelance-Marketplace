generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
  binaryTargets   = ["native", "linux-musl"]
}

datasource db {
  provider = "postgresql"
  schemas  = ["users", "sync"]
}

model User {
  id                     String                 @id @default(uuid())
  availableConnects      Int                    @default(50)
  address                String?
  avatarUrl              String?
  badges                 String[]
  banExpiresAt           DateTime?
  banReason              String?
  companyLogo            String?
  companyName            String?
  companySize            String?
  completionPercentage   Int                    @default(0)
  country                String?
  createdAt              DateTime               @default(now())
  email                  String                 @unique
  emailNotifications     Boolean                @default(true)
  firstName              String?
  googleId               String?                @unique
  hourlyRate             Decimal?
  idDocument             String?
  inAppNotifications     Boolean                @default(true)
  industry               String?
  isAvailable            Boolean                @default(true)
  isIdentityVerified     Boolean                @default(false)
  isPaymentVerified      Boolean                @default(false)
  isPromoted             Boolean                @default(false)
  jobSuccessScore        Int                    @default(100)
  kycStatus              String                 @default("PENDING")
  language               String?                @default("en")
  lastName               String?
  linkedinId             String?                @unique
  overview               String?
  password               String?
  phone                  String?
  primaryCategoryId      String?
  promotionExpiresAt     DateTime?
  pushNotifications      Boolean                @default(true)
  rating                 Decimal                @default(0.0)
  resetPasswordExpiresAt DateTime?
  resetPasswordToken     String?
  reviewCount            Int                    @default(0)
  roles                  String[]               @default(["FREELANCER"])
  skills                 String[]
  status                 String                 @default("ACTIVE")
  timezone               String?                @default("UTC")
  title                  String?
  trustScore             Int                    @default(100)
  twoFactorEnabled       Boolean                @default(false)
  twoFactorSecret        String?
  updatedAt              DateTime               @updatedAt
  website                String?
  referralCode           String?                @unique
  facebookId             String?                @unique
  githubId               String?                @unique
  isEmailVerified        Boolean                @default(false)
  taxId                  String?
  billingAddress         String?

  // Portfolio Platform Integration
  githubUsername         String?
  behanceUsername        String?
  dribbbleUsername       String?
  portfolioSyncEnabled   Boolean                @default(false)
  lastPortfolioSync      DateTime?

  // Behavioral Metrics
  communicationStyle     String?                // Proactive, Formal, Concise, etc.
  avgResponseTime        Float?                 // in minutes
  reliabilityScore       Float                  @default(100)

  availability           AvailabilityCalendar[]
  education              Education[]
  experience             Experience[]
  portfolio              PortfolioItem[]
  ownedTeams             Team[]
  teams                  TeamMember[]
  profile                Profile?               @relation("UserProfile")
  referredBy             Referral?              @relation("Referred")
  referrals              Referral[]             @relation("Referrer")

  savedFreelancers       SavedFreelancer[]      @relation("ClientSaved")
  savedByClients         SavedFreelancer[]      @relation("FreelancerSaved")

  @@map("users")
  @@schema("users")
}

model Profile {
  id                String   @id @default(uuid())
  userId            String   @unique
  headline          String?
  bio               String?
  hourlyRate        Decimal?
  skills            String[]
  primaryCategoryId String?
  isComplete        Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation("UserProfile", fields: [userId], references: [id])

  @@map("profiles")
  @@schema("users")
}

model Referral {
  id           String   @id @default(uuid())
  referrerId   String
  referredId   String   @unique
  status       String   @default("PENDING")
  rewardAmount Decimal  @default(0.0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  referred     User     @relation("Referred", fields: [referredId], references: [id])
  referrer     User     @relation("Referrer", fields: [referrerId], references: [id])

  @@map("referrals")
  @@schema("users")
}

model AvailabilityCalendar {
  id        String   @id @default(uuid())
  userId    String
  date      DateTime
  isBusy    Boolean  @default(true)
  note      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])

  @@unique([userId, date])
  @@schema("users")
}

model Education {
  id           String    @id @default(uuid())
  institution  String
  degree       String
  fieldOfStudy String
  startDate    DateTime
  endDate      DateTime?
  description  String?
  userId       String
  user         User      @relation(fields: [userId], references: [id])
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@schema("users")
}

model Experience {
  id          String    @id @default(uuid())
  company     String
  title       String
  location    String?
  startDate   DateTime
  endDate     DateTime?
  current     Boolean   @default(false)
  description String?
  userId      String
  user        User      @relation(fields: [userId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@schema("users")
}

model PortfolioItem {
  id             String    @id @default(uuid())
  title          String
  description    String?
  imageUrl       String
  projectUrl     String?
  skills         String[]
  completionDate DateTime?
  source         String    @default("MANUAL") // MANUAL, GITHUB, BEHANCE, DRIBBBLE
  externalId     String?
  externalUrl    String?
  userId         String
  user           User      @relation(fields: [userId], references: [id])
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@schema("users")
}

model Team {
  id          String       @id @default(uuid())
  name        String
  description String?
  logoUrl     String?
  ownerId     String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  owner       User         @relation(fields: [ownerId], references: [id])
  members     TeamMember[]

  @@schema("users")
}

model TeamMember {
  id        String   @id @default(uuid())
  teamId    String
  userId    String
  role      String   @default("MEMBER")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  team      Team     @relation(fields: [teamId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@unique([teamId, userId])
  @@schema("users")
}

model SavedFreelancer {
  id           String   @id @default(uuid())
  clientId     String
  freelancerId String
  note         String?
  tags         String[]
  createdAt    DateTime @default(now())

  client       User     @relation("ClientSaved", fields: [clientId], references: [id])
  freelancer   User     @relation("FreelancerSaved", fields: [freelancerId], references: [id])

  @@unique([clientId, freelancerId])
  @@schema("users")
}

model SyncTombstone {
  id        String   @id @default(uuid())
  entity    String   // e.g., "User", "PortfolioItem"
  recordId  String
  deletedAt DateTime @default(now())
  
  @@index([entity, deletedAt])
  @@map("sync_tombstones")
  @@schema("users")
}
