_format_version: "3.0"
_transform: true

services:
  - name: user-service
    url: http://freelance_user_service:3000
    routes:

      # =====================
      # Auth Routes (PUBLIC)
      # /api/auth/register -> /register
      # =====================
      - name: auth-public
        paths:
          - /api/auth
        strip_path: true

      # =====================
      # User Read Routes (PUBLIC)
      # /api/users -> /
      # =====================
      - name: user-read
        paths:
          - /api/users
        methods:
          - GET
        strip_path: true

      # =====================
      # User Protected Routes (JWT)
      # =====================
      - name: user-protected
        paths:
          - /api/users
        methods:
          - POST
          - PUT
          - PATCH
          - DELETE
        strip_path: true


  - name: job-service
    url: http://freelance_job_service:3002
    routes:
      - name: job-all-routes
        paths:
          - /api/jobs
          - /api/proposals
          - /api/reports
        strip_path: false

  - name: contract-service
    url: http://freelance_contract_service:3004
    routes:
      - name: contract-routes
        paths:
          - /api/contracts
        strip_path: true

  - name: payment-service
    url: http://freelance_payment_service:3005
    routes:
      - name: payment-routes
        paths:
          - /api/payments
        strip_path: true

  - name: chat-service
    url: http://freelance_chat_service:3006
    routes:
      - name: chat-routes
        paths:
          - /api/chat
        strip_path: true

  - name: notification-service
    url: http://freelance_notification_service:3007
    routes:
      - name: notification-routes
        paths:
          - /api/notifications
        strip_path: true

  - name: review-service
    url: http://freelance_review_service:3008
    routes:
      - name: review-read
        paths:
          - /api/reviews
        methods:
          - GET
        strip_path: true
      - name: review-write
        paths:
          - /api/reviews
        methods:
          - POST
          - PUT
          - PATCH
          - DELETE
        strip_path: true

  - name: admin-service
    url: http://freelance_admin_service:3009
    routes:
      - name: admin-routes
        paths:
          - /api/admin
        strip_path: true

  - name: search-service
    url: http://freelance_search_service:3010/search
    routes:
      - name: search-read
        paths:
          - /api/search
        methods:
          - GET
        strip_path: true
      - name: search-write
        paths:
          - /api/search
        methods:
          - POST
          - PUT
          - PATCH
          - DELETE
        strip_path: true

  - name: analytics-service
    url: http://freelance_analytics_service:3014
    routes:
      - name: analytics-routes
        paths:
          - /api/analytics
        strip_path: true

  - name: storage-service
    url: http://freelance_storage_service:3011/storage
    routes:
      - name: storage-read
        paths:
          - /api/storage
        methods:
          - GET
        strip_path: true
      - name: storage-write
        paths:
          - /api/storage
        methods:
          - POST
          - PUT
          - PATCH
          - DELETE
        strip_path: true

  - name: common-service
    url: http://freelance_common_service:3013/common
    routes:
      - name: common-read
        paths:
          - /api/common
        methods:
          - GET
        strip_path: true
      - name: common-write
        paths:
          - /api/common
        methods:
          - POST
          - PUT
          - PATCH
          - DELETE
        strip_path: true

  - name: email-service
    url: http://freelance_email_service:3012
    routes:
      - name: email-routes
        paths:
          - /api/email
        strip_path: true

consumers:
  - username: keycloak-user
    jwt_secrets:
      - key: "http://keycloak:8080/realms/freelance-marketplace"
        algorithm: RS256
        rsa_public_key: |
          -----BEGIN PUBLIC KEY-----
          MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyjLQxxPmDkuU/I5CySrogRuST6SeVJMc530Pabjv6EPEUx4z+SUfHGaVQCxYYWGQ2e/LyCg1CIv7/JGtn/iCsdAH4iXoAJDgOWZEi/nUX4k9/U8xtTXrIz+KqCYRzYr1U5Us1er+NyCSLVTyYQQHa1rotQIbJ9gGFIRrN9wMMljsoyWRNuqPrmBvWcc/Cc5Xf1PGeIpp/X6Izi1FnYzJTsbAgdUFzA8rmEJtQwW2hYbVWfRe3IsrYy944l2vVYoFDeimuD7mrslr5LEauocWoIRvlKBxSWgbfdWTH1qsLQxy5YCXdRJWhbLHOJk6rpjXjb5S5UFWoCblV0pShM13+wIDAQAB
          -----END PUBLIC KEY-----

plugins:
  - name: cors
    config:
      origins:
        - "http://localhost:3000"
      methods:
        - GET
        - POST
        - PATCH
        - DELETE
        - OPTIONS
      headers:
        - Accept
        - Accept-Version
        - Content-Length
        - Content-MD5
        - Content-Type
        - Date
        - Authorization
      exposed_headers:
        - X-Auth-Token
      credentials: true
      max_age: 3600
  - name: rate-limiting
    config:
      minute: 100
      policy: local
